<!DOCTYPE html>
<html lang="en">
    <head>
        <title>PID Simulator - AMB Robotics Calculator</title>
        <link rel="icon" href="img/logo.png">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="css/main.css">
        <link rel="stylesheet" href="css/calculators.css">
        <link rel="stylesheet" href="css/pid.css">
        <script src="js/chart.js"></script>
        <script src="js/jquery.min.js"></script>
        <link rel="stylesheet" href="css/tipso.min.css">
        <script src="js/tipso.min.js"></script>
        <script src="js/calculators.js"></script>
        <script src="js/pid.js"></script>
    </head>
    <body>
        <header>
            <a href="index.html">
                <img src="img/logo.png" class="logo" alt="logo">
            </a>
            <div class="header-title">
                <h1>PID Simulator</h1>
                <input class="title" type="text">
            </div>
            <div style="flex: 1;"></div>
            <div class="header-left">
                <button class="header-button docs" data-link="projectile">DOCS</button>
                <div class="units-buttons">
                    <button class="header-button imperial">IMPERIAL</button>
                    <button class="header-button metric">METRIC</button>
                </div>
                <button class="header-button copy-link">COPY<br>LINK</button>
                <button class="header-button reset">RESET</button>
            </div>
        </header>
        <main>
            <div class="inputs">
                <div class="page-element" id="motor-spec">
                    <select id="motor">
                        <option>Custom</option>
                    </select>
                    <div class="break"></div>
                    <div class="field">
                        <label for="mot_wf">Free Speed</label>
                        <input id="mot_wf" class="motor-update motor-prop" type="number" step="any" min="0" disabled>
                        &nbsp;rpm
                    </div>
                    <div class="field">
                        <label for="mot_ts">Stall Torque</label>
                        <input id="mot_ts" class="motor-update motor-prop" type="number" step="any" min="0" disabled>
                        <select id="mot_ts-u" class="motor-update motor-prop">
                            <option value="1">Nm</option>
                            <option value="0.00706">oz-in</option>
                            <option value="1.35582">ft-lbs</option>
                        </select>
                    </div>
                    <div class="field">
                        <label for="mot_if">Free Current</label>
                        <input id="mot_if" class="motor-update motor-prop" type="number" step="any" min="0" disabled>
                        &nbsp;Amps
                    </div>
                    <div class="field">
                        <label for="mot_is">Stall Current</label>
                        <input id="mot_is" class="motor-update motor-prop" type="number" step="any" min="0" disabled>
                        &nbsp;Amps
                    </div>
                    <div class="field">
                        <label for="mot_num">Number of Motors</label>
                        <input id="mot_num" class="motor-update" type="number" min="1" step="1" value="1">
                    </div>
                    <div class="field">
                        <label for="ilim" data-tipso="Maximum supply-side current any single motor can draw. Leave blank to allow for infinite current draw">Current Limit</label>
                        <input id="ilim" type="number" step="any" min="0">
                        &nbsp;
                        <span>Amps</span>
                    </div>
                </div>
                <div class="page-element" id="radios">
                    <div class="pid-type">
                        <div>
                            <label for="pos" data-tipso="Closed-loop control on the mechanism's position (e.g. elevator)">Position</label>
                            <input id="pos" name="pid-type" type="radio" checked>
                        </div>
                        <div>
                            <label for="vel" data-tipso="Closed-loop control on the mechanism's velocity (e.g. shooter)">Velocity</label>
                            <input id="vel" name="pid-type" type="radio">
                        </div>
                    </div>
                    <div class="lin-rot">
                        <div>
                            <label for="lin" data-tipso="Output of the mechanism is linear motion (e.g. wheel, pulley)">Linear</label>
                            <input id="lin" name="lin-rot" type="radio">
                        </div>
                        <div>
                            <label for="rot" data-tipso="Output of the mechanism is rotational motion (e.g. arm, flywheel)">Rotational</label>
                            <input id="rot" name="lin-rot" type="radio" checked>
                        </div>
                    </div>
                    <div class="field lin pos">
                        <label for="start_pos_lin" data-tipso="Starting position of the mechanism">Start Position</label>
                        <input id="start_pos_lin" type="number" step="any" value="0">
                        <select id="start_pos_lin-u">
                            <option value="0.0254" class="imperial">inch</option>
                            <option value="1" class="metric">meter</option>
                            <option value="0.3048">foot</option>
                            <option value="0.001">mm</option>
                        </select>
                    </div>
                    <div class="field lin pos">
                        <label for="goal_pos_lin" data-tipso="Desired final position of the mechanism">Target Position</label>
                        <input id="goal_pos_lin" type="number" step="any">
                        <select id="goal_pos_lin-u">
                            <option value="0.0254" class="imperial">inch</option>
                            <option value="1" class="metric">meter</option>
                            <option value="0.3048">foot</option>
                            <option value="0.001">mm</option>
                        </select>
                    </div>
                    <div class="field rot pos">
                        <label for="start_pos_rot" data-tipso="Starting angle of the mechanism">Start Position</label>
                        <input id="start_pos_rot" type="number" step="any" value="0">
                        <span>&nbsp;&deg;</span>
                    </div>
                    <div class="field rot pos">
                        <label for="goal_pos_rot" data-tipso="Desired final position of the mechanism">Target Position</label>
                        <input id="goal_pos_rot" type="number" step="any" value="180">
                        <span>&nbsp;&deg;</span>
                    </div>
                    <div class="field lin vel">
                        <label for="start_vel_lin" data-tipso="Starting speed of the mechanism">Start Speed</label>
                        <input id="start_vel_lin" type="number" step="any" value="0">
                        <select id="start_vel_lin-u">
                            <option value="0.0254" class="imperial">in/s</option>
                            <option value="1" class="metric">m/s</option>
                            <option value="0.3048">ft/s</option>
                            <option value="0.001">mm/s</option>
                        </select>
                    </div>
                    <div class="field lin vel">
                        <label for="goal_vel_lin" data-tipso="Desired final speed of the mechanism">Target Speed</label>
                        <input id="goal_vel_lin" type="number" step="any">
                        <select id="goal_vel_lin-u">
                            <option value="0.0254" class="imperial">in/s</option>
                            <option value="1" class="metric">m/s</option>
                            <option value="0.3048">ft/s</option>
                            <option value="0.001">mm/s</option>
                        </select>
                    </div>
                    <div class="field rot vel">
                        <label for="start_vel_rot" data-tipso="Starting speed of the mechanism">Start Speed</label>
                        <input id="start_vel_rot" type="number" step="any" value="0">
                        <span>&nbsp;rpm</span>
                    </div>
                    <div class="field rot vel">
                        <label for="goal_vel_rot" data-tipso="Desired final speed of the mechanism">Target Speed</label>
                        <input id="goal_vel_rot" type="number" step="any">
                        <span>&nbsp;rpm</span>
                    </div>
                </div>
                <div class="page-element" id="mechanism">
                    <div class="field">
                        <label for="rat" data-tipso="Total gear ratio between the motor and mechanism output">Gear Ratio</label>
                        <input id="rat" type="number" step="any" min="0" value="10">
                        <span>&nbsp;: 1</span>
                    </div>
                    <div class="field lin">
                        <label for="mass_lin" data-tipso="Mass of the mechanism">Mass</label>
                        <input id="mass_lin" type="number" step="any" min="0">
                        <select id="mass_lin-u">
                            <option value="0.455" class="imperial">lbs</option>
                            <option value="1" class="metric">kg</option>
                        </select>
                    </div>
                    <div class="field rot pos">
                        <label for="mass_rot" data-tipso="Mass of the mechanism">Mass</label>
                        <input id="mass_rot" type="number" step="any" min="0" value="10">
                        <select id="mass_rot-u">
                            <option value="0.455" class="imperial">lbs</option>
                            <option value="1" class="metric">kg</option>
                        </select>
                    </div>
                    <div class="field rot vel">
                        <label for="moi" data-tipso="Moment of inertia of the spinning mechanism">MoI</label>
                        <input id="moi" type="number" step="any" min="0">
                        <select id="moi-u">
                            <option value="0.04214" class="imperial">lb*ft²</option>
                            <option value="1" class="metric">kg*m²</option>
                        </select>
                    </div>
                    <div class="field">
                        <label for="radius" class="lin" data-tipso="Radius used to translate rotational to linear motion">Radius</label>
                        <label for="radius" class="rot" data-tipso="Distance between Center of Mass and rotation axis (used to calculate Moment of Inertia, to enter MoI use radius of 1)">Radius</label>
                        <input id="radius" type="number" step="any" min="0" value="1">
                        <select id="radius-u">
                            <option value="0.0254" class="imperial">inch</option>
                            <option value="0.001" class="metric">mm</option>
                            <option value="0.3048">foot</option>
                            <option value="1">meter</option>
                        </select>
                    </div>
                    <div class="field lin">
                        <label for="load_cnst_lin" data-tipso="Force always applied to the system not dependant on mechanism position or velocity">Constant Load</label>
                        <input id="load_cnst_lin" type="number" step="any" min="0" value="0">
                        <select id="load_cnst_lin-u">
                            <option value="4.448" class="imperial">lbs</option>
                            <option value="9.81">kg</option>
                            <option value="1" class="metric">N</option>
                        </select>
                    </div>
                    <div class="field lin">
                        <label for="load_visc_lin" data-tipso="Force applied to the system proportional to the mechanism velocity">Viscous Load</label>
                        <input id="load_visc_lin" type="number" step="any" min="0" value="0">
                        <select id="load_visc_lin-u">
                            <option value="1.355" class="imperial">lbs/(ft/s)</option>
                            <option value="9.81">kg/(m/s)</option>
                            <option value="1" class="metric">N/(m/s)</option>
                        </select>
                    </div>
                    <div class="field rot vel">
                        <label for="load_cnst_rot" data-tipso="Torque always applied to the system not dependant on mechanism position or velocity">Constant Load</label>
                        <input id="load_cnst_rot" type="number" step="any" min="0">
                        <select id="load_cnst_rot-u">
                            <option value="1.35582" class="imperial">ft-lbs</option>
                            <option value="1" class="metric">Nm</option>
                            <option value="0.00706">oz-in</option>
                        </select>
                    </div>
                    <!-- <div class="field rot">
                        <label for="load_cos" data-tipso="Torque applied to the system proportional to the cosine of the mechanism angle">Cosine Load</label>
                        <input id="load_cos" type="number" step="any" min="0">
                        <select id="load_cos-u">
                            <option value="1.35582" class="imperial">ft-lbs</option>
                            <option value="1" class="metric">Nm</option>
                            <option value="0.00706">oz-in</option>
                        </select>
                    </div> -->
                    <div class="field rot">
                        <label for="load_visc_rot" data-tipso="Torque applied to the system proportional to the mechanism velocity">Viscous Load</label>
                        <input id="load_visc_rot" type="number" step="any" min="0">
                        <select id="load_visc_rot-u">
                            <option value="1.35582" class="imperial">ft-lbs/rpm</option>
                            <option value="1" class="metric">Nm/rpm</option>
                            <option value="0.00706">oz-in/rpm</option>
                        </select>
                    </div>
                    <div class="field rot pos">
                        <label for="grv" data-tipso="Add a load due to gravity (where 0° is horizontal)">Gravity Load</label>
                        <input id="grv" type="checkbox">
                    </div>
                </div>
                <div class="page-element" id="constants">
                    <div class="field">
                        <label for="pv_units" data-tipso="Process variable units per rotation of the motor shaft.<br>For internal encoder, set to 1.<br>For quadrature encoder, number of ticks per rotation of the motor shaft.<br>For absolute encoder, 1&nbsp;/&nbsp;gear&nbsp;ratio between motor and encoder">Units Per Rotation</label>
                        <input id="pv_units" type="number" min="0" value="1">
                    </div>
                    <!-- <div class="field">
                        <label for="full_scale" data-tipso="Value representing the maximum allowable output regardless of units. 1&nbsp;for Duty Cycle control (CTRE/REV), 12&nbsp;for Voltage control&nbsp;(CTRE), current limit value for Current Limit control&nbsp;(CTRE)">Full Scale</label>
                        <input id="full_scale" type="number" min="0" value="1">
                    </div> -->
                    <div class="field">
                        <input id="closedloop" type="checkbox" checked>
                        <label for="closedloop" data-tipso="Enable closed-loop control (when disabled, motor runs at full power)">Closed Loop</label>
                    </div>
                    <div class="row closedloop">
                        <div class="field">
                            <label for="kp" data-tipso="Proportional coefficient">kP</label>
                            <input id="kp" type="number" min="0" step="any" value="1">
                        </div>
                        <div class="field">
                            <label for="kd" data-tipso="Derivative coefficient">kD</label>
                            <input id="kd" type="number" min="0" step="any" value="0">
                        </div>
                    </div>
                    <div class="row closedloop">
                        <div class="field">
                            <label for="ki" data-tipso="Integral coefficient">kI</label>
                            <input id="ki" type="number" min="0" step="any" value="0">
                        </div>
                        <div class="field">
                            <label for="imax" data-tipso="Maximum contribution to the output by the integrator term (-1 to 1)">Imax</label>
                            <input id="imax" type="number" min="-1" max="1" step="any" value="1">
                        </div>
                    </div>
                    <div class="row closedloop">
                        <div class="field rot">
                            <label for="kg" class="lin" data-tipso="Gravity-based feed-forward coefficient (constant)">kG</label>
                            <label for="kg" class="rot" data-tipso="Gravity-based feed-forward coefficient (proportional to cosine of angle)">kG</label>
                            <input id="kg" type="number" min="0" step="any" value="0">
                        </div>
                        <div class="field vel">
                            <label for="kv" data-tipso="Velocity feed-forward coefficient">kV</label>
                            <input id="kv" type="number" min="0" step="any" value="0">
                        </div>
                    </div>
                </div>
                <div class="page-element" id="params">
                    <div class="field">
                        <label for="maxt" data-tipso="Maximum simulation time">Max Time</label>
                        <input id="maxt" type="number" min="0" value="5">
                        <span>&nbsp;s</span>
                    </div>
                    <div class="field">
                        <label for="dt" data-tipso="Time per simulation step">Timestep</label>
                        <input id="dt" type="number" min="0" value="5">
                        <span>&nbsp;ms</span>
                    </div>
                    <div class="field">
                        <label for="ss" data-tipso="The maximum rate of change allowed for the mechanism to reach steady-state and for the simulation to end">Steady-State Limit</label>
                        <input id="ss" type="number" min="0" value="0.01">
                        <span class="pos">&nbsp;m/s</span>
                        <span class="vel">&nbsp;m/s²</span>
                    </div>
                </div>
            </div>
            <div class="page-element graph">
                <span class="warn">ENTER VALID INPUTS TO SEE TRAJECTORY</span>
                <canvas id="graph"></canvas>
            </div>
        </main>
        <footer>
            <a href="https://firstupdatesnow.com/" class="fun-logo">
                <img src="img/fun_logo.jpg">
            </a>
            <span>
                Created by Ari Meles-Braverman &copy; 2022. For educational purposes only. Contact <a class="contact" href="https://www.chiefdelphi.com/u/arimb/summary" style="text-decoration: underline;">&commat;AriMB</a> on ChiefDelphi with questions or suggestions.
            </span>
            <div></div>
        </footer>
    </body>
</html>